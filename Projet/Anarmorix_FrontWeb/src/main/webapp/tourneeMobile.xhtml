<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html">

<h:head>
  <meta charset="UTF-8"></meta>
  <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"/> 
  <h:outputScript library="js" name="markerclusterer.js"/>
  <script async="async" defer="defer" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCf-7j3fGn9ixB1w2exeFysSJtWlWUYiFc&amp;callback=initMap"></script>
</h:head>
<body class="w3-row">
  <header class="w3-col s12 w3-bar w3-card w3-purple w3-mobile">
    <button class="w3-bar-item w3-button w3-hover-purple w3-xxxlarge" onclick="openSidebar()">&#9776;</button>
    <h4 class="w3-bar-item"> Tournée n°#{mbTournee.selectedTournee.id} du 24/09/2017</h4>
  </header>
  <div class="w3-container w3-col s12">
    <div class="w3-row">
      <div id="map" class="w3-col s12" style="height:50vh"></div>
      <button onclick="show('itineraire')" class="w3-button w3-block w3-purple w3-hover-purple">Itinéraire</button>
      <div id="itineraire" class="w3-col s12 w3-hide"></div>
      <button onclick="show('arrets')" class="w3-button w3-block w3-purple w3-hover-purple">Points d'arrêts</button>
      <div id="arrets" class="w3-col s12 w3-hide">
        <table class="w3-table-all w3-centered w3-small w3-mobile">
          <thead>
            <tr>
              <th>Nom</th>
              <th>Produits à récupérer/déposer</th>
            </tr>
          </thead>
          <ui:repeat var="com" value="#{mbTournee.commercesAVisiter}">
          <tr class="w3-hover-purple" onclick="document.getElementById('producteur-#{com.commerce.id}').style.display='block'">
            <td>#{com.commerce.raisonSociale}</td>
            <td>#{com.listeLigneCmd.size()}</td>
          </tr>
          </ui:repeat>
        </table>
        <ui:repeat var="com" value="#{mbTournee.commercesAVisiter}">
        <h:form>
        <div id="producteur-#{com.commerce.id}" class="w3-modal">
          <div class="w3-modal-content">
            <header class="w3-bar w3-red">
              <h5 class="w3-bar-item">#{com.commerce.raisonSociale}</h5>
              <h:commandButton value="Tout récupérer" styleClass="w3-bar-item w3-button w3-green w3-margin-top"></h:commandButton>
              <span onclick="document.getElementById('producteur-#{com.commerce.id}').style.display='none'" class="w3-button w3-right w3-bar-item w3-xlarge">X</span>
            </header>
            <ul class="w3-ul w3-card-4">
              <ui:repeat var="prod" value="#{com.listeLigneCmd}">
              <li>
                <div class="w3-row">
                  <span class="w3-col s4">#{prod.produit.type.libelle}</span>
                  <div class="w3-col s4">
                    <span>Qté à récupérer:</span>
                    <span>#{prod.quantitePreparee}</span>
                    <span>#{prod.produit.packaging.unite.unite}</span>
                  </div>
                  <div class="w3-col s4">
                    <button class="w3-button w3-green">OK</button>
                    <button class="w3-button w3-yellow">!</button>
                  </div>
                </div>
              </li>
              </ui:repeat>
            </ul>
          </div>
        </div>
        </h:form>
        </ui:repeat>
      </div>
    </div>
  </div>
  <script type="text/javascript">
  //<![CDATA[
      var map;
        function initMap() {
          var wP = #{mbTournee.jSonWayPoints};
          var directionsDisplay = new google.maps.DirectionsRenderer;
          var directionsService = new google.maps.DirectionsService;
          map = new google.maps.Map(document.getElementById('map'), {
            zoom: 7,
            center: {lat: 41.85, lng: -87.65}
          });
          directionsDisplay.setMap(map);
          directionsDisplay.setPanel(document.getElementById('itineraire'));

          directionsService.route({
        	  origin: {lat: 48.782303, lng: -3.059167},
        	  destination: {lat: 48.782303, lng: -3.059167},
        	  waypoints: wP,
        	  optimizeWaypoints: true,
              travelMode: 'DRIVING'
          }, function(response, status) {
            console.log(status)
            if (status === 'OK') {
              directionsDisplay.setDirections(response);
            } else {
              window.alert('Directions request failed due to ' + status);
            }
          });
        }
        function show(id){
        	var x = document.getElementById(id);
            if (x.className.indexOf("w3-show") == -1) {
                x.className += " w3-show";
            } else {
                x.className = x.className.replace(" w3-show", "");
            }
        }
      //]]>
  </script>
</body>

</html>
